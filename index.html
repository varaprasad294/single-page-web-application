<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Minimal To-Do</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <main class="app" aria-labelledby="app-title">
    <header class="header">
      <h1 id="app-title">To-Do</h1>
      <form id="todo-form" class="add">
        <label for="todo-input" class="sr-only">Add a new task</label>
        <input id="todo-input" type="text" placeholder="What needs to be done?" autocomplete="off" />
        <button type="submit" class="btn">Add</button>
      </form>
    </header>

    <section class="controls" aria-label="Filters">
      <div class="filters" role="tablist" aria-label="Filter tasks">
        <button class="chip is-active" role="tab" aria-selected="true" data-filter="all">All</button>
        <button class="chip" role="tab" aria-selected="false" data-filter="active">Active</button>
        <button class="chip" role="tab" aria-selected="false" data-filter="completed">Completed</button>
      </div>
      <div class="meta">
        <span id="items-left">0 items left</span>
        <button id="clear-completed" class="link">Clear completed</button>
      </div>
    </section>

    <ul id="todo-list" class="list" aria-live="polite" aria-label="To-do items"></ul>

    <footer class="footer">
      <small>Local storage powered. No backend required.</small>
    </footer>
  </main>

  <template id="item-template">
    <li class="item">
      <label class="checkbox">
        <input type="checkbox" />
        <span class="check"></span>
      </label>
      <input class="title" />
      <button class="delete" aria-label="Delete task" title="Delete">Ã—</button>
    </li>
  </template>

  <script>
    // --- Storage helpers ---
    const STORAGE_KEY = "minimal-todo-items";
    const load = () => JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]");
    const save = (items) => localStorage.setItem(STORAGE_KEY, JSON.stringify(items));

    // --- State ---
    let items = load(); // [{ id, title, completed }]
    let filter = "all"; // all | active | completed

    // --- Elements ---
    const form = document.getElementById("todo-form");
    const input = document.getElementById("todo-input");
    const list = document.getElementById("todo-list");
    const template = document.getElementById("item-template");
    const itemsLeft = document.getElementById("items-left");
    const clearCompletedBtn = document.getElementById("clear-completed");
    const filterButtons = [...document.querySelectorAll(".filters .chip")];

    // --- Rendering ---
    function render() {
      list.innerHTML = "";
      const frag = document.createDocumentFragment();
      visibleItems().forEach((item) => {
        const el = template.content.firstElementChild.cloneNode(true);

        const checkbox = el.querySelector('input[type="checkbox"]');
        const title = el.querySelector(".title");
        const del = el.querySelector(".delete");

        el.dataset.id = item.id;
        checkbox.checked = item.completed;
        title.value = item.title;
        title.setAttribute("aria-label", `Edit: ${item.title}`);
        if (item.completed) el.classList.add("is-completed");

        // Events
        checkbox.addEventListener("change", () => toggle(item.id));
        title.addEventListener("change", (e) => rename(item.id, e.target.value));
        title.addEventListener("keydown", (e) => {
          if (e.key === "Enter") { e.target.blur(); }
        });
        del.addEventListener("click", () => remove(item.id));

        frag.appendChild(el);
      });
      list.appendChild(frag);
      updateMeta();
      updateFilterUI();
      save(items);
    }

    function visibleItems() {
      if (filter === "active") return items.filter(i => !i.completed);
      if (filter === "completed") return items.filter(i => i.completed);
      return items;
    }

    function updateMeta() {
      const left = items.filter(i => !i.completed).length;
      itemsLeft.textContent = `${left} item${left !== 1 ? "s" : ""} left`;
    }

    function updateFilterUI() {
      filterButtons.forEach(btn => {
        const active = btn.dataset.filter === filter;
        btn.classList.toggle("is-active", active);
        btn.setAttribute("aria-selected", active ? "true" : "false");
      });
    }

    // --- CRUD ---
    function add(title) {
      const t = title.trim();
      if (!t) return;
      items.unshift({ id: crypto.randomUUID(), title: t, completed: false });
      render();
    }
    function toggle(id) {
      items = items.map(i => i.id === id ? { ...i, completed: !i.completed } : i);
      render();
    }
    function rename(id, title) {
      const t = title.trim();
      items = items.map(i => i.id === id ? { ...i, title: t || i.title } : i);
      render();
    }
    function remove(id) {
      items = items.filter(i => i.id !== id);
      render();
    }
    function clearCompleted() {
      items = items.filter(i => !i.completed);
      render();
    }

    // --- Events ---
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      add(input.value);
      input.value = "";
      input.focus();
    });

    filterButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        filter = btn.dataset.filter;
        render();
      });
    });

    clearCompletedBtn.addEventListener("click", clearCompleted);

    // --- Init ---
    render();
  </script>
</body>
</html>
